# DNS 解析与优化

[[toc]]

## 什么是 DNS

DNS（Domain Name System，域名系统）是互联网中用于将人类可读的域名（如 `www.example.com`）转换为机器可识别的 IP 地址（如 `192.0.2.1`）的分布式数据库系统。它是互联网基础设施的核心组成部分，简化了用户访问网络资源的过程。DNS 系统采用客户/服务器模型，其协议运行在 UDP 之上，使用 53 号端口。其域名系统包含下面三个组成单元，如下所示：

- 层次域名空间
- 域名服务器
- 域名解析

## 层次域名空间

### 域的构成

域是互联网中用于划分和管理网络资源的逻辑单位，通常对应一个组织、服务或网站。域还可以划分为子域，而子域还可以继续划分为子域的子域，这样就形成了顶级域、二级域、三级域等，然后使用树状结构来组织。
![树状结构](https://image-bucket-1307756649.cos.ap-chengdu.myqcloud.com/image/20250716160245040.png)

### 域名概念

因特网采用层次树状结构的命名方法。采用这种命名方法，任何一个连接到因特网的主机或路由器，都有一个唯一的层次结构名称，即域名（Domain Name）。域名的书写规则如下：

- 标号中的英文不区分大小写
- 标号中除连字符（`・`）外不能使用其他的标点符号
- 每个标号不超过 63 个字符，多标号组成的完整域名最长不超过 255 个字符

::: tip 常用顶级域名
域名不仅用于标识网络资源的位置（如网站、服务器），还能通过其结构和命名方式体现资源的所属范畴和作用比如顶级域名(Top Level Domain,TLD)的三类：

- 国家（地区）顶级域名：如`.cn` 表示中国，`.us`表示美国，`.uk` 表示英国。
- 通用顶级域名：常见的有`.com`（公司）、`.net`（网络服务机构）、`.org` （非营利性组织）和`.gov`（国家或政府部门）等。
- 基础结构域名：这种顶级域名只有一个，即 arpa,用于反向域名解析，因此又称反向域名。

:::

## 域名服务器

### 组织方式

1. **分布式设计**

   - DNS 是一个**联机分布式数据库**，采用**客户端/服务器模型**。
   - 域名解析由**域名服务器**上的程序完成。

2. **区（Zone）的概念**

   - 每个服务器负责管辖一个**区**（不是以“域”为单位）。
   - 一个区内的所有主机必须能互相连通。
   - 每个区有一个**权限域名服务器**，存储该区所有主机的 **域名 →IP 映射**。

### 四类域名服务器

DNS 是分布式系统，各级服务器分工协作，最终将域名转换为 IP 地址。

1. 根域名服务器：

   - 管理顶级域（如 `.com、.org`）。
   - 不直接解析域名，而是指引查询到对应的顶级域名服务器。

2. 顶级域名服务器：

   - 管理其下的二级域名（如 `baidu.com` 中的 `.com` 部分）。
   - 返回最终结果或下一步应查询的授权域名服务器地址。

3. 授权域名服务器（权限域名服务器）：

   - 存储具体域名（如 `www.baidu.com`）对应的 IP 地址。
   - 是域名解析的最终权威来源。

4. 本地域名服务器：
   - 用户直接配置的 DNS 服务器（如 8.8.8.8）。
   - 接收用户查询，并代表用户向其他服务器逐级请求解析结果。

## 域名解析

### 正反向解析

域名解析是指把域名映射成为 IP 地址或把 IP 地址映射成域名的过程。前者称为正向解析，后者称为反向解析。

### 域名解析有两种方式

#### 递归查询方式

![递归查询方式](https://image-bucket-1307756649.cos.ap-chengdu.myqcloud.com/image/20250716165741808.png)
主机向本地域名服务器的查询采用的是递归查询

#### 递归与迭代相结合的方式

![递归与迭代相结合的方式](https://image-bucket-1307756649.cos.ap-chengdu.myqcloud.com/image/20250716165713640.png)

1. 主机向本地域名服务器的查询采用的是递归查询
2. 本地域名服务器向根域名服务器的查询采用迭代查询

### 域名解析过程（以迭代方式为例）

**1. 客户机发起递归查询**

- **动作**：用户主机（客户机）向**本地 DNS 服务器**发送递归查询请求（如 `y.abc.com`）。
- **特点**：本地 DNS 必须返回最终 IP 或错误，客户机不参与后续查询。

**2. 本地 DNS 迭代查询根服务器**

- **动作**：本地 DNS 向**根域名服务器**查询 `y.abc.com`。
- **返回结果**：根服务器返回 `.com` 顶级域服务器的 IP 地址（无直接解析）。

**3. 本地 DNS 查询顶级域服务器**

- **动作**：本地 DNS 向 `.com` 顶级域服务器查询 `abc.com`。
- **返回结果**：顶级域服务器返回 `abc.com` 的**授权域名服务器**IP。

**4. 本地 DNS 查询授权域名服务器**

- **动作**：本地 DNS 向 `abc.com` 的授权服务器查询 `y.abc.com`。
- **返回结果**：授权服务器返回 `y.abc.com` 的最终 IP 地址。

**5. 本地 DNS 返回结果给客户机**

- **动作**：本地 DNS 将 IP 地址返回给用户主机，完成解析。

## 域名解析优化

当用户第一次访问一个网站的时候，比如访问 `www.example.com`，会先进行 DNS 解析，然后再访问网站，对于网站中的静态资源，比如图片、视频等，也会进行 DNS 解析。DNS 解析的过程会消耗时间，因此可以采取一些优化措施来提高用户体验。

### 提前解析

使用`<link ref="dns-prefetch" href="">`标签预解析域名，可以在构建 DOM 树的同时，提前解析域名，减少 DNS 解析时间。
或者使用`<link ref="preconnect" href="">`提前与目标服务器建立连接，减少请求延迟

::: warning 痛点
开发中需要提取这些静态资源的域名，然后同 `script` 动态设置到 `head` 下。
`dns` 解析是毫秒级别的，如需优化，可安装插件 `npm install vite-plugin-cdn-import`，帮助从项目中引入 CDN 资源，从而提高项目的加载速度和性能。
:::

### 本地缓存

浏览器默认缓存 DNS
