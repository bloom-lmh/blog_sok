# 数据链路层

[[toc]]

## 基本概念

数据链路层是 OSI 七层模型中的第二层，位于物理层和网络层之间，负责在直接相连的节点 ​（如同一局域网内的设备）之间提供可靠的数据传输。它的核心任务是将原始比特流组织成帧，并通过物理地址（如 MAC 地址）进行寻址和错误控制。

## 核心功能

- 成帧（`Framing`）​​：将物理层传来的比特流划分为有意义的数据帧，并添加帧头、帧尾。
- 物理寻址（`MAC 地址`）​​：通过 `MAC` 地址标识发送方和接收方（如 `00:1A:2B:3C:4D:5E`）。
- 差错控制 ​：检测和纠正传输错误（如 `CRC` 校验）。
- 流量控制 ​：防止发送方淹没接收方（如滑动窗口协议）。
- 访问控制 ​：协调共享介质的使用（如以太网的 `CSMA/CD`）。

## 子层划分

数据链路层通常分为两个子层：

- ​LLC（逻辑链路控制层）​​：负责流量控制、差错检测（如 `IEEE 802.2`）。
- ​MAC（介质访问控制层）​​：管理物理寻址和介质访问（如以太网的 `CSMA/CD`）。

## 完整案例

### 收的过程

以下是一个完整的数据链路层帧传输过程，以家用路由器（IP: `192.168.1.1`）向电脑（IP: `192.168.1.2`）发送一个 HTTP 网页请求为例。

步骤 1：路由器封装帧

1. 网络层生成 IP 包 ​：路由器准备发送一个 HTTP 请求的 IP 包（目标 IP: `192.168.1.2`，源 IP: `192.168.1.1`）。
2. 数据链路层封装 ​：通过 ARP 协议查询 `192.168.1.2` 对应的 MAC 地址（假设为 `00:1A:2B:3C:4D:5E`）。添加帧头、帧尾，组成完整的以太网帧。

步骤 2：物理层传输

1. 调制为电信号 ​：网卡将帧的比特流转换为高低电平信号 ​（如曼彻斯特编码）。
2. 通过网线发送 ​：电信号通过双绞线传输到交换机。

步骤 3：交换机处理

1. 读取目标 MAC 地址 ​：交换机检查帧头中的目标 MAC（`00:1A:2B:3C:4D:5E`）。
2. 转发到目标端口 ​：根据 MAC 地址表，将帧发送到连接电脑的端口。

步骤 4：电脑接收帧

1. 网卡解调 ​：电脑网卡将电信号还原为比特流，并校验 FCS（CRC32）。
2. 剥离帧头帧尾 ​：若校验通过，提取数据部分的 IP 包，交给网络层处理。

### 发的过程

假设你的电脑（`192.168.1.2`）要访问百度服务器（`14.215.177.39`），步骤如下：

步骤 1：应用层 → 传输层，生成 HTTP 请求 → 封装为 TCP 段 ​（源端口随机，目标端口 80）。
步骤 2：网络层封装

- 电脑检查目标 IP（14.215.177.39），发现不在本地网络（192.168.1.0/24）。
- ​ 将 IP 包的目标 MAC 设为默认网关 ​（路由器 192.168.1.1 的 MAC）。

步骤 3：网卡将 IP 包封装为以太网帧 ​

```bash
| 目标MAC: 路由器MAC | 源MAC: 电脑MAC | 类型: 0x0800 (IPv4) | IP包 | FCS |
```

步骤 4：物理层传输(网卡调制为电信号 → 通过网线发送到交换机。)
步骤 5：交换机处理（交换机根据目标 MAC（路由器 MAC）​，将帧转发到连接路由器的端口。）
步骤 6：路由器处理

- 剥离帧头，检查 IP 包的目标 IP（14.215.177.39）。
- 通过路由表决定下一跳（如 ISP 的网关）。
- ​ 重新封装帧 ​：
  - ​ 目标 MAC 改为下一跳设备的 MAC​（通过 ARP 查询）。
  - ​ 源 MAC 改为路由器出口的 MAC。
- 从 WAN 口发送到互联网。
