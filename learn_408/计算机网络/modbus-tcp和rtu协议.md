### **Modbus-TCP 和 Modbus-RTU 的区别**

Modbus 是一种广泛应用于工业自动化领域的通信协议，主要有 **Modbus-TCP**（基于以太网）和 **Modbus-RTU**（基于串口，如 RS485）两种变体。它们的核心区别如下：

---

## **1. 物理层 & 通信方式**

| **特性**       | **Modbus-TCP**                  | **Modbus-RTU**                |
| -------------- | ------------------------------- | ----------------------------- |
| **物理接口**   | 以太网（TCP/IP）                | RS485 / RS232                 |
| **传输方式**   | 基于 IP 网络（WiFi/以太网）     | 串行通信（点对点或多点）      |
| **通信速率**   | 100 Mbps ~ 1 Gbps（取决于网络） | 通常 9600 ~ 115200 bps        |
| **最大设备数** | 理论上无限制（受网络限制）      | 通常 32 ~ 247 个设备（RS485） |

---

## **2. 数据帧结构**

### **(1) Modbus-TCP**

- **MBAP 头（7 字节） + PDU（协议数据单元）**
  - **MBAP 头**（Modbus Application Protocol Header）：
    - **事务标识符（2 字节）**：匹配请求和响应（类似 TCP 序列号）
    - **协议标识符（2 字节）**：固定 `0x0000`（表示 Modbus）
    - **长度（2 字节）**：后续数据的字节数
    - **单元标识符（1 字节）**：类似 RTU 的从机地址（通常 `0x01`）
  - **PDU**（功能码 + 数据）：
    - 与 RTU 相同，但没有 CRC 校验（TCP 自带校验）

**示例（读取寄存器 0x0000~0x0015）：**

```
00 00 00 00 00 06 01 03 00 00 00 15
```

- `00 00`：事务 ID
- `00 00`：协议 ID
- `00 06`：后续数据长度（6 字节）
- `01`：单元 ID
- `03`：功能码（读寄存器）
- `00 00`：起始地址
- `00 15`：寄存器数量

---

### **(2) Modbus-RTU**

- **从机地址（1 字节） + PDU（功能码+数据） + CRC（2 字节）**
  - **从机地址**：设备地址（1~247）
  - **PDU**：功能码 + 数据（与 TCP 相同）
  - **CRC 校验**：2 字节循环冗余校验（确保数据完整性）

**示例（读取寄存器 0x0000~0x0015）：**

```
01 03 00 00 00 15 44 0C
```

- `01`：从机地址
- `03`：功能码（读寄存器）
- `00 00`：起始地址
- `00 15`：寄存器数量
- `44 0C`：CRC 校验

---

## **3. 主要区别总结**

| **对比项**     | **Modbus-TCP**         | **Modbus-RTU**              |
| -------------- | ---------------------- | --------------------------- |
| **适用场景**   | 工业以太网、远程监控   | 本地设备通信（PLC、传感器） |
| **传输距离**   | 理论上无限（依赖网络） | 通常 ≤ 1200 米（RS485）     |
| **数据校验**   | 依赖 TCP/IP 校验       | 使用 CRC 校验               |
| **设备数量**   | 支持大规模组网         | 最多 247 个设备（RS485）    |
| **通信速率**   | 快（100Mbps+）         | 较慢（通常 9600~115200bps） |
| **实现复杂度** | 需要 IP 网络支持       | 只需串口通信                |

---

## **4. 如何选择？**

- **选 Modbus-TCP**：

  - 需要远程监控（通过互联网）
  - 高速、大数据量通信（如 SCADA 系统）
  - 设备支持以太网（如工业网关、智能仪表）

- **选 Modbus-RTU**：
  - 本地设备通信（PLC、传感器、仪表）
  - 低成本、低功耗（RS485 硬件简单）
  - 短距离、抗干扰强（工业现场）

---

## **5. 协议转换**

如果设备仅支持 **Modbus-RTU**，但需要通过 **Modbus-TCP** 访问，可以使用：

- **RS485 转 TCP 网关**（如 MOXA NPort、USR-TCP232）
- **软件转换**（如 `pymodbus` 库的 RTU-over-TCP 模式）

---

### **总结**

- **Modbus-TCP** 适用于 **以太网环境**，适合远程、高速通信。
- **Modbus-RTU** 适用于 **串口环境**，适合本地、低成本设备通信。
- **两者 PDU 相同**，主要区别在物理层和帧头结构。

如果你的设备文档要求 **Modbus-RTU**，但代码用了 **Modbus-TCP**，通信会失败，需调整协议或使用网关转换！
