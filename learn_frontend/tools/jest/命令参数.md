# 命令参数

[[toc]]

以下是 Jest 测试框架的常用命令参数分类详解，配合具体使用场景说明：

## 基础执行控制

| 参数                        | 说明                                                                   | 示例                                   |
| --------------------------- | ---------------------------------------------------------------------- | -------------------------------------- |
| `jest`                      | 运行所有测试（默认匹配 `__tests__` 目录和 `.test.js`/`.spec.js` 文件） | `jest`                                 |
| `jest <文件名>`             | 运行指定测试文件                                                       | `jest user.test.js`                    |
| `jest --watch`              | 监听模式（根据 git 变更自动运行相关测试）                              | `jest --watch`                         |
| `jest --watchAll`           | 监听所有测试文件                                                       | `jest --watchAll`                      |
| `--findRelatedTests <文件>` | 运行与指定文件相关的测试                                               | `jest --findRelatedTests src/utils.js` |

**场景**：开发时实时反馈测试结果

```bash
# 开发组件时专注当前测试
jest Button.test.js --watch
```

## 筛选测试用例

| 参数                       | 说明                   | 示例                                    |
| -------------------------- | ---------------------- | --------------------------------------- |
| `-t <模式>`                | 运行匹配名称的测试用例 | `jest -t "login"`                       |
| `--testNamePattern=<模式>` | 同 `-t`（支持正则）    | `jest --testNamePattern="API.*success"` |
| `--testPathPattern=<模式>` | 匹配测试文件路径       | `jest --testPathPattern=/components/`   |
| `--filter=<文件>`          | 通过配置文件筛选       | `jest --filter=config.json`             |

**场景**：快速运行特定测试

```bash
# 只测试登录失败场景
jest -t "login.*fail"
```

## 输出控制

| 参数             | 说明                          | 示例                             |
| ---------------- | ----------------------------- | -------------------------------- |
| `--verbose`      | 显示详细测试结果              | `jest --verbose`                 |
| `--silent`       | 静默模式（禁止 console 输出） | `jest --silent`                  |
| `--noStackTrace` | 隐藏错误调用栈                | `jest --noStackTrace`            |
| `--colors`       | 强制启用彩色输出              | `jest --colors`                  |
| `--reporters`    | 自定义报告器                  | `jest --reporters=default,junit` |

**场景**：CI 环境使用

```bash
# 在CI服务器上运行测试
jest --ci --silent --noStackTrace
```

## 覆盖率报告

| 参数                           | 说明               | 示例                                       |
| ------------------------------ | ------------------ | ------------------------------------------ |
| `--coverage`                   | 生成覆盖率报告     | `jest --coverage`                          |
| `--collectCoverageFrom=<glob>` | 指定覆盖率统计范围 | `jest --collectCoverageFrom="src/**/*.js"` |
| `--coverageDirectory=<dir>`    | 指定报告输出目录   | `jest --coverageDirectory=reports`         |
| `--coverageReporters=<格式>`   | 指定报告格式       | `jest --coverageReporters=text,html`       |

**场景**：生成可视化报告

```bash
# 生成HTML格式覆盖率报告
jest --coverage --coverageReporters=html
```

## 性能优化

| 参数                 | 说明                   | 示例                  |
| -------------------- | ---------------------- | --------------------- |
| `--maxWorkers=<num>` | 设置最大工作线程数     | `jest --maxWorkers=4` |
| `--runInBand`        | 禁用并行（单线程运行） | `jest --runInBand`    |
| `--cache`            | 启用缓存（默认）       | `jest --cache`        |
| `--no-cache`         | 禁用缓存               | `jest --no-cache`     |
| `--shard=<shard>`    | 分片执行测试           | `jest --shard=1/3`    |

**场景**：大型项目优化

```bash
# 使用75% CPU核心并行测试
jest --maxWorkers=75%
```

## 调试相关

| 参数                  | 说明             | 示例                       |
| --------------------- | ---------------- | -------------------------- |
| `--inspect`           | 启用 Node 调试器 | `jest --inspect`           |
| `--detectOpenHandles` | 检测未关闭的资源 | `jest --detectOpenHandles` |
| `--logHeapUsage`      | 记录堆内存使用   | `jest --logHeapUsage`      |
| `--env=<环境>`        | 指定测试环境     | `jest --env=jsdom`         |

**场景**：内存泄漏检测

```bash
# 检查测试中的资源泄漏
jest --detectOpenHandles --logHeapUsage
```

## 配置覆盖

| 参数                | 说明             | 示例                                 |
| ------------------- | ---------------- | ------------------------------------ |
| `--config=<文件>`   | 指定配置文件     | `jest --config=custom.config.js`     |
| `--projects=<项目>` | 多项目配置       | `jest --projects=frontend/ backend/` |
| `--forceExit`       | 强制退出（慎用） | `jest --forceExit`                   |
| `--updateSnapshot`  | 更新快照         | `jest --updateSnapshot`              |

**场景**：多项目测试

```bash
# 同时运行前后端测试
jest --projects=frontend/ backend/
```
