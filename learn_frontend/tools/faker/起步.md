# 起步

[[toc]]

## 基本概念

### 简介

Faker 是一个流行的库，可以生成虚假（但合理）的数据，可用于以下用途：

- 单元测试
- 性能测试
- 构建演示
- 在没有完整后端的情况下工作

### Faker 的核心模块

Faker 有三种类型的模块：

- 基本数据类型的模块：`datatype、date、number` 和 `string`
- 特定主题的模块，例如 `animal、food` 等等
- 最后，helpers 模块，具有各种实用方法可用于你自己的数据（或由其他 Faker 方法生成的数据）

## 环境搭建

### 安装

使用 `npm` 安装 Faker：`npm install @faker-js/faker --save-dev`

### 环境要求

你可以在浏览器或 `Node.js` 中运行 `Faker`。`Faker v9.0` 需要 `Node.js` 版本 `18` 或更高版本。`ESM` 和 `CommonJS`导入均可用。

## 基本用法

### 可复现的结果

正常情况下 `faker.js` 生成的随机数据是不可复现的，这意味着每次运行程序都会生成不同的随机数据。

```js
faker.music.genre(); // "Soul"
faker.music.genre(); // "Reggae"
```

为了生成可复现的随机数据，你需要设置一个种子（seed）。种子是一个数字，它将用于初始化随机数生成器，从而生成相同的随机数序列。

```js
faker.seed(123);
const firstRandom = faker.number.int();
// Setting the seed again resets the sequence.
faker.seed(123);
const secondRandom = faker.number.int();
console.log(firstRandom === secondRandom);
```

::: warning 注意一些值即便设置相同的随机种子也可能不同
当升级到新版本的 Faker 时，你可能会获得相同种子的不同值，因为基础数据（名称、单词等列表）可能已更改。

有几种使用相对日期的方法，设置随机种子不足以获得可重现的结果，例如：`faker.date.past`、`faker.date.future`、`faker.date.birthdate`、`faker.date.recent`、`faker.date.soon` 和 `faker.git.commitEntry`。这是因为这些方法默认在 "today" 之前或之后创建日期，而 "today" 取决于代码的运行时间。要解决此问题，你可以将固定参考日期指定为日期或字符串，例如：

```js
// creates a date soon after 2023-01-01
faker.date.soon({ refDate: '2023-01-01T00:00:00.000Z' });
```

或者，你也可以为所有这些方法设置一个默认参考日期：

```js
// sets the default reference date to 2023-01-01
faker.setDefaultRefDate('2023-01-01T00:00:00.000Z');
```

:::

### 简单的数据生成

Faker 提供了一个 `simpleFaker`，可用于生成不基于任何语言环境的数据，如数字和字符串。还有像 `arrayElement` 或 `multiple` 这样的助手可用。

```js
import { simpleFaker } from '@faker-js/faker';

const uuid = simpleFaker.string.uuid();
```

### 创建复杂对象

Faker 主要为原语生成值。这是因为在现实世界中，大多数对象模式看起来非常不同。因此，如果你想创建一个对象，你很可能需要为其编写一个工厂函数

```js
import type { SexType } from '@faker-js/faker';

type SubscriptionTier = 'free' | 'basic' | 'business';
interface User {
  _id: string;
  avatar: string;
  birthday: Date;
  email: string;
  firstName: string;
  lastName: string;
  sex: SexType;
  subscriptionTier: SubscriptionTier;
}
```

对于上面的类型我们可以编写一个工厂函数

1. 某些项可以会依赖于某些项，比如 `email` 依赖于 `firstName` 和 `lastName`，这样生成的数据才真实
2. 可以传入 options 来控制属性

```js
import { faker } from '@faker-js/faker';

function createRandomUser(overwrites: Partial<User> = {}): User {
  const {
    _id = faker.string.uuid(),
    avatar = faker.image.avatar(),
    birthday = faker.date.birthdate(),
    sex = faker.person.sexType(),
    firstName = faker.person.firstName(sex),
    lastName = faker.person.lastName(),
    // 邮箱依赖于 firstName 和 lastName
    email = faker.internet.email({ firstName, lastName }),
    subscriptionTier = faker.helpers.arrayElement(['free', 'basic', 'business']),
  } = overwrites;

  return {
    _id,
    avatar,
    birthday,
    email,
    firstName,
    lastName,
    sex,
    subscriptionTier,
  };
}

const user = createRandomUser();
// 传入的 options 覆盖默认值
const userToReject = createRandomUser({ birthday: new Date('2124-10-20') });
```
