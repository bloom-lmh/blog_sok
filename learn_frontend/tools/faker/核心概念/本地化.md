# 本地化

[[toc]]

## 切换语言环境

Faker 支持超过 70 多种语言环境，可用语言环境请见[官网](https://faker.nodejs.cn/guide/localization.html#custom-locales-and-fallbacks)，例如，你可以导入德语语言环境:

```js
import { fakerDE as faker } from '@faker-js/faker';
```

这样你模拟的数据就是以德语为基础的。

## 区域设置代码

区域代码用于获取不同区域环境所支持的数据

### 区域代码结构

区域设置代码用于标识不同语言/地区的差异，格式为：`语言代码_国家代码_变体`

- `en` → 英语（通用）
- `en_US` → 英语（美国）
- `zh_CN` → 中文（中国大陆）
- `sr_RS_latin` → 塞尔维亚语（拉丁字母版）

### 基本使用

1. 访问预定义的区域数据：通过 `allLocales` 获取原始语言环境定义（如地址格式、姓名规则）

```js
import { allLocales } from '@faker-js/faker';
console.log(allLocales['de_AT'].address); // 查看奥地利德语的地址规则
```

2. 获取对应语言的 Faker 实例：通过 `allFakers` 直接生成地区 `faker` 实例

```js
// 方式1：从 allFakers 获取
import { allFakers } from '@faker-js/faker';
const japaneseFaker = allFakers['ja_JP'];
console.log(japaneseFaker.person.fullName()); // 如 "田中 太郎"

// 方式2：直接导入
import { fakerJA_JP } from '@faker-js/faker';
console.log(fakerJA_JP.person.fullName()); // 同上
```

## 自定义语言环境

如果默认语言环境的数据不满足需求（例如需要生成域名时以 `.test`为后缀），你可以通过自定义语言环境扩展或覆盖默认数据，比如假设你正在开发一个瑞士德语区的电商平台测试模块，需要生成符合以下要求的假数据：

- ​ 域名 ​：强制使用 `.shop` 后缀（而非默认的 `.com` 或 `.de`）。
- ​ 地址 ​：优先使用瑞士格式（`de_CH`），但街道名称需包含 `[测试]` 前缀。
- ​ 商品名称 ​：后备数据用英语（`en`），避免德语缺失字段。

```js
import type { LocaleDefinition } from '@faker-js/faker';
import { base, de, de_CH, en, Faker } from '@faker-js/faker';

// 1. 自定义语言环境
const customLocale: LocaleDefinition = {
  title: 'Swiss E-Commerce Test Data',
  internet: {
    domainSuffix: ['shop'], // 覆盖为 .shop
  },
  address: {
    streetPrefix: ['[测试]'], // 街道名前加标记
  },
};

// 2. 创建自定义 Faker 实例
export const customFaker = new Faker({
  locale: [customLocale, de_CH, de, en, base], // 优先级顺序
});

// 3. 使用示例
const testData = {
  shopDomain: customFaker.internet.domainName(), // → 如 "example.shop"
  street: customFaker.location.street(), // → 如 "[测试] Bahnhofstrasse"
  productName: customFaker.commerce.productName(), // → 英语商品名（如 "Steel Chair"）
};

console.log(testData);
```

解释：

- `customLocale`:你的自定义数据，优先级最高。例如这里强制将 `internet.domainSuffix` 设为 `['test']`，生成域名时会优先使用它
- `[customLocale, de_CH, de, en, base]`：是顺序检查，先在 `customLocale` 中找数据，若找不到 → 检查 `de_CH`（瑞士德语）→ `de`（通用德语）→ `en`（英语，数据最全）→ `base`（基础数据，如表情符号）

::: tip 自定义语言环境的两个方面

1. 自定义某些数据：如 `internet.domainSuffix`，`address.streetPrefix` 等，当调用`.internet`时会触发自定义的`.internet`
2. 添加后备语言环境： 当某个字段在当前语言环境中不存在时，会回退到列表中的下一个语言环境，直到找到数据为止，比如 `locale: [customLocale, de_CH, de, en, base]`。

:::

## 缺失数据处理

某些语言比较小众，语言环境没有对应的语言数据就会报错，比如当你调用 `faker.category.entry()` 时，Faker 会检查当前语言环境是否定义了 `category.entry` 字段。若该字段未在 el 中定义，就会抛出此错误:

```bash
[Error]: The locale data for 'category.entry' are missing in this locale.
Please contribute the missing data to the project or use a locale/Faker instance that has these data.
For more information see https://faker.nodejs.cn/guide/localization.html
```

对于数据缺失的情况有如下解决方法（本质上都是在自定义语言环境）：

1. 添加后备语言环境 ​：修改 Faker 实例的 locale 配置，让缺失字段回退到其他语言（如英语 en 或基础数据 base）

```js
import { Faker, base, el, en } from '@faker-js/faker';
const faker = new Faker({
-  locale: [el], // 仅用希腊语
+  locale: [el, en, base], // 希腊语 → 英语 → 基础数据
});
```

2. 自定义语言环境：手动补充缺失字段到自定义语言环境

```js
const customLocale = {
  category: {
    entry: ['自定义数据1', '自定义数据2'], // 补全缺失字段
  },
};
const faker = new Faker({
  locale: [customLocale, el], // 优先用自定义数据
});
```

## 处理不适用数据错误

有一些地方没有一些数据，比如香港没有邮政编码，因此 `en_HK` 语言环境无法提供这些数据。其他语言环境和方法也是如此。

```js
import { fakerEN_HK } from '@faker-js/faker';

console.log(fakerEN_HK.location.zipCode()); // Error
```

如果你收到此错误，则表示当前语言环境无法为该方法提供合理的值：

```bash
[Error]: The locale data for 'category.entry' aren't applicable to this locale.
If you think this is a bug, please report it at: https://github.com/faker-js/faker
```

解决方法：

1. 默认`null`：官方默认将这些没有的数据设置为了`null`（依然会报错，所以推荐 2 方式）
2. 自定义后备数据：若需覆盖缺失字段，可通过混合语言环境实现

```js
import { Faker, en, en_HK } from '@faker-js/faker';

const faker = new Faker({
  locale: [
    { location: { postcode: en.location.postcode } }, // 强制使用英语邮编
    en_HK, // 其他字段仍用香港数据
  ],
});
console.log(faker.location.zipCode()); // 输出英语邮编（如 "90210"）
```
