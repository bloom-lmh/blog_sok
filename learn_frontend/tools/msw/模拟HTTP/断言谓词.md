# 断言谓词

[[toc]]

断言谓词是请求拦截器的基本组成部分，它定义了要拦截的请求的条件，在本节中，我们将了解定义请求处理程序断言的不同方式，以及各种参数

## 断言谓词的三种方式

MSW 提供了三种类型的断言方式：

### 相对 URL

使用相对 URL 作为断言时

1. 浏览器环境下会自动与当前文档（location.href）进行拼接，比如程序运行在 http://localhost:3000，则下面的断言会拦截 http://// localhost:3000/resource
2. node 环境下不会自动拼接，需要手动拼接，你需要在你的 Node.js 测试中配置基础 URL

```js
http.get('/resource', () => {});
```

### 绝对 URL

当你以绝对请求 URL 作为断言时，发出的请求必须匹配其协议、主机和路径名，才能触发请求处理程序

```js
// :owner/:repo 是一个路径参数，会在请求处理程序中被替换为实际的值
http.post('https://api.github.com/repos/:owner/:repo', () => {});
```

### 正则表达式

你可以提供一个正则表达式作为请求处理程序的断言。MSW 会将其与发出的请求 URL 进行测试，以确定是否匹配

```js
http.get(/\/settings\/(profile|settings)/, () => {});
```

## URL 中的符号

### 查询参数

断言谓词中可以包含查询参数，但它们不会影响 URL 匹配。因为这些参数会被自动移除，如下所示：

```js
http.get('/resource?query=param', () => {});
// 等价于
http.get('/resource', () => {});
```

虽然这些参数会在请求处理程序中被移除，但这不会影响你在发送请求时添加的查询参数，你的请求仍然可以包含查询参数，并且可以在响应解析器中访问它们，具体请看响应解析器所在小节

### 路径参数

使用字符串请求断言时，你可以在其中包含路径参数：

1. 一般路径参数：使用冒号（`:`）作为路径参数的后缀，表示该参数是必需的。确保在类型中反映这一点

```js
http.get < { id: string } > ('/users/:id', () => {});
```

2. 可选路径参数：使用问号(`?`)作为路径参数的后缀，表示该参数是可选的。由于它们的值可能为空，确保在类型中反映这一点

```js
// 使用下述请求处理程序，`GET /post`和`GET /post/abc-123`请求都将匹配，但`GET /post/abc-123/edit`将不会
http.get<{ id?: string }>('/posts/:id?', ({ params }) => {
  const { id } = params
})
```

2. 重复路径参数：将加号（`+`）用作路径参数的后缀，以表示其值重复。重复的路径参数将在 `params` 对象中以值数组的形式表示。

```js
http.get<{ segments: string[] }>('/settings/:segments+', ({ params }) => {
  console.log(params.segments)
})
```

### 转义分号

有时你可能希望在请求路径中包含分号（`;`），而不将其作为参数。使用双反斜杠（`\\`）来转义这样的分号：

```js
http.get('/songs/\\:genre/\\:artist', () => {});
```
