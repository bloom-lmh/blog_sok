# 自动序列化机制

[[toc]]

## 表单类型自动序列化

如果 `content-type` 标头设置为 `application/x-www-form-urlencoded`，axios 会自动将数据对象序列化为 `urlencoded` 格式。这在浏览器和 node.js 中都有效：

```js
const data = {
  x: 1,
  arr: [1, 2, 3],
  arr2: [1, [2], 3],
  users: [
    { name: 'Peter', surname: 'Griffin' },
    { name: 'Thomas', surname: 'Anderson' },
  ],
};

await axios.post('https://postman-echo.com/post', data, {
  headers: { 'content-type': 'application/x-www-form-urlencoded' },
});
```

自动序列化为`urlencoded` 格式，如下所示：

```js
{
  x: '1',
  'arr[]': [ '1', '2', '3' ],
  'arr2[0]': '1',
  'arr2[1][0]': '2',
  'arr2[2]': '3',
  'arr3[]': [ '1', '2', '3' ],
  'users[0][name]': 'Peter',
  'users[0][surname]': 'griffin',
  'users[1][name]': 'Thomas',
  'users[1][surname]': 'Anderson'
}
```

如果你的服务器框架的请求主体解析器（如 `body-parser` 或 `express.js`）支持嵌套对象解码，你将自动收到与你提交的相同的请求对象。以 express.js 为例，你可以使用 `express.json()` 和 `express.urlencoded()` 中间件来自动解析请求主体。

```js
var app = express();

app.use(bodyParser.urlencoded({ extended: true })); // support url-encoded bodies

app.post('/', function (req, res, next) {
  res.send(JSON.stringify(req.body));
  /*
{
  x: '1',
  arr: ['1', '2', '3'],
  arr2: ['1', ['2'], '3'],
  users: [
    { name: 'Peter', surname: 'Griffin' },
    { name: 'Thomas', surname: 'Anderson' }
  ]
}
*/
});

server = app.listen(3000);
```

## 多部分的主体自动序列化

从 v0.27.0 开始，如果请求 `Content-Type` 标头设置为 `multipart/form-data`，axios 支持自动将对象序列化为 `FormData` 对象。
以下请求将以 FormData 格式（浏览器和 Node.js）提交数据：

```js
import axios from 'axios';

axios
  .post(
    'https://httpbin.org/post',
    {
      user: {
        name: 'Dmitriy',
      },
      file: fs.createReadStream('/foo/bar.jpg'),
    },
    {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    }
  )
  .then(({ data }) => console.log(data));
```

::: tip 快捷语法
axios 支持以下快捷方法：`postForm、putForm、patchForm` 就是对应的 HTTP 方法，`content-type` 标头预设为 `multipart/form-data`。FileList 对象可以直接传递：

```js
await axios.postForm(
  'https://httpbin.org/post',
  document.querySelector('#fileInput').files
);
```

所有文件都将使用相同的字段名称发送：files[]
:::

## 自动推断机制

Axios 的自动序列化可以根据你发送的类型智能推断如何转换数据格式

| 你发送的数据类型            | Axios 自动选择的 Content-Type       | 转换方式                         |
| --------------------------- | ----------------------------------- | -------------------------------- |
| 普通 JS 对象 `{key: value}` | `application/json`                  | 自动转成 JSON 字符串             |
| URLSearchParams 对象        | `application/x-www-form-urlencoded` | 自动转成 `key=value&key2=value2` |
| FormData 对象（含文件）     | `multipart/form-data`               | 保持二进制格式不转换             |
| 字符串数据                  | `text/plain`                        | 直接发送原始字符串               |

::: tip get 请求

- 所有参数会被自动转成 `?key=value` 形式拼到 URL 后面
- 不会设置 ​ `Content-Type` 头
  :::
