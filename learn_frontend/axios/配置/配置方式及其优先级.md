# 配置方式机器优先级

[[toc]]
Axios 提供了灵活的配置系统，主要通过三种方式设置配置，它们的优先级和应用场景各不相同。

## 库默认配置

Axios 库有默认配置，就类似于 Axios 的出厂设置，在`node_modules/axios/lib/defaults/index.js`中。

## 用户的三种配置方式

### 全局默认配置

适用场景 ​：项目中所有请求共享的基础配置,创建 Axios 实例时会基础全局默认配置。

```js
// 设置全局默认配置
axios.defaults.baseURL = 'https://api.example.com';
axios.defaults.timeout = 5000;
axios.defaults.headers.common['Authorization'] = 'Bearer token123';

// 所有请求都会继承这些配置
axios.get('/users'); // 实际请求 https://api.example.com/users
```

### 实例配置

适用场景 ​：需要多个独立配置的 HTTP 客户端时，与全局默认配置相同时，实例配置可以覆盖全局默认配置。

```js
// 创建自定义实例时传入实例配置
const apiClient = axios.create({
  timeout: 8000,
  headers: { 'X-Custom-Header': 'foo' },
});
// 也可以创建完实例后再覆盖默认配置,与上面创建实例时传入默认配置是等效的
apiClient.defaults.baseURL = 'https://api.special.com';
// 使用实例配置
apiClient.get('/data'); // 使用实例的baseURL
```

### 单个请求时配置

适用场景 ​：需要临时覆盖全局/实例配置的特殊请求

```js
// 即使设置了全局或实例配置，这里的配置会优先生效
axios.get('/items', {
  timeout: 3000, // 临时设置超时
  params: { page: 2 }, // 添加查询参数
});

// 实例请求的临时配置
apiClient.post(
  '/submit',
  { data: payload },
  {
    headers: { 'X-Request-ID': '123' },
  }
);
```

## 配置优先级和合并规则

### 优先级

单个请求配置 > 实例配置 > 全局默认配置> 库默认配置

### 合并规则

配置将按优先顺序合并。顺序先是 `lib/defaults/index.js` 中的库默认值，然后是全局配置，然后是实例的 defaults 属性，最后是请求的 config 参数。这里有一个例子：

```js
// 1. 全局配置
axios.defaults.timeout = 5000;
axios.defaults.baseURL = 'https://global-api.com';

// 2. 实例配置
const instance = axios.create({
  timeout: 10000, // 覆盖全局的5000
  baseURL: 'https://instance-api.com', // 覆盖全局的baseURL
});

// 3. 单个请求配置
instance.get('/users', {
  timeout: 30000, // 覆盖实例的10000
  baseURL: 'https://request-api.com', // 覆盖实例的baseURL
});
```
