# 请求处理

[[toc]]

## 配置概述

与请求行为相关的配置项如下：
::: code-group

```js [通用配置]
// 【重要】请求超时时间（毫秒），0表示不超时
timeout: 1000,

// 【现代】AbortController信号（用于取消请求）
signal: new AbortController().signal,

// 【已废弃】取消令牌（旧版取消请求方式）
cancelToken: new CancelToken(function (cancel) {
}),

```

```js [node专用配置]
// 【Node专用】请求体最大长度（字节）
maxBodyLength: 2000,
```

:::

## 请求超时设置-timeout

```js
// 1. 设置超时时间
axios.defaults.timeout = 1000;

// 2. 发起请求
axios
  .get('/api/data')
  .then((response) => {
    console.log(response.data);
  })
  .catch((error) => {
    if (axios.isAxiosError(error)) {
      console.log('请求超时:', error.message);
    } else {
      console.log('请求错误:', error);
    }
  });
```

## 请求取消设置-AbortController

```js
// 1. 创建 AbortController 实例
const controller = new AbortController();

// 2. 发起请求并传入 signal
axios
  .get('/api/data', {
    signal: controller.signal,
  })
  .then((response) => {
    console.log(response.data);
  })
  .catch((error) => {
    if (axios.isCancel(error)) {
      console.log('请求被取消:', error.message);
    } else {
      console.log('请求错误:', error);
    }
  });

// 3. 取消请求
controller.abort('用户取消了请求'); // 可以传入取消原因
```

示例 1：组件卸载时取消请求（React）​

```js
import { useEffect } from 'react';

function MyComponent() {
  useEffect(() => {
    const controller = new AbortController();

    axios
      .get('/api/data', {
        signal: controller.signal,
      })
      .then((response) => {
        // 处理数据
      });

    // 组件卸载时取消请求
    return () => {
      controller.abort('组件卸载，取消请求');
    };
  }, []);

  return <div>...</div>;
}
```

示例二：闭包封装取消请求

```js
function makeCancelableRequest(url) {
  const controller = new AbortController();

  const request = axios.get(url, {
    signal: controller.signal,
  });

  return {
    request,
    cancel: (reason) => controller.abort(reason),
  };
}

// 使用示例
const { request, cancel } = makeCancelableRequest('/api/data');

request.then(/*...*/).catch(/*...*/);

// 需要取消时
cancel('操作超时');
```
