# 匹配器概览

[[toc]]

## 基础断言方法

| 方法            | 功能                    | 示例                                                    |
| --------------- | ----------------------- | ------------------------------------------------------- |
| `expect(value)` | 创建断言                | `expect(5)`                                             |
| `.not`          | 反转匹配器结果          | `expect(5).not.toBe(3)`                                 |
| `.resolves`     | 解包 Promise 的解决值   | `expect(Promise.resolve(5)).resolves.toBe(5)`           |
| `.rejects`      | 解包 Promise 的拒绝原因 | `expect(Promise.reject('error')).rejects.toBe('error')` |

## 基本匹配器

| 方法                    | 功能                 | 示例                                                 |
| ----------------------- | -------------------- | ---------------------------------------------------- |
| `.toBe(value)`          | 严格相等比较         | `expect(5).toBe(5)`                                  |
| `.toEqual(value)`       | 深度相等比较         | `expect({a:1}).toEqual({a:1})`                       |
| `.toStrictEqual(value)` | 严格深度相等比较     | `expect([1, ,3]).not.toStrictEqual([1,undefined,3])` |
| `.toBeDefined()`        | 检查值不是 undefined | `expect(5).toBeDefined()`                            |
| `.toBeUndefined()`      | 检查值是 undefined   | `expect(undefined).toBeUndefined()`                  |
| `.toBeNull()`           | 检查值是 null        | `expect(null).toBeNull()`                            |
| `.toBeTruthy()`         | 检查值为真值         | `expect(1).toBeTruthy()`                             |
| `.toBeFalsy()`          | 检查值为假值         | `expect(0).toBeFalsy()`                              |
| `.toBeNaN()`            | 检查值是 NaN         | `expect(NaN).toBeNaN()`                              |

## 数值比较匹配器

| 方法                         | 功能           | 示例                                  |
| ---------------------------- | -------------- | ------------------------------------- |
| `.toBeGreaterThan(n)`        | 大于比较       | `expect(5).toBeGreaterThan(3)`        |
| `.toBeGreaterThanOrEqual(n)` | 大于等于比较   | `expect(5).toBeGreaterThanOrEqual(5)` |
| `.toBeLessThan(n)`           | 小于比较       | `expect(3).toBeLessThan(5)`           |
| `.toBeLessThanOrEqual(n)`    | 小于等于比较   | `expect(5).toBeLessThanOrEqual(5)`    |
| `.toBeCloseTo(n, digits?)`   | 浮点数近似比较 | `expect(0.1+0.2).toBeCloseTo(0.3, 5)` |

## 字符串匹配器

| 方法                      | 功能                     | 示例                                    |
| ------------------------- | ------------------------ | --------------------------------------- |
| `.toMatch(regexp/string)` | 字符串匹配正则或子串     | `expect('hello').toMatch('ell')`        |
| `.toContain(item)`        | 包含特定项(数组或字符串) | `expect('hello').toContain('ell')`      |
| `.toContainEqual(item)`   | 深度包含特定项           | `expect([{a:1}]).toContainEqual({a:1})` |

## 数组和对象匹配器

| 方法                            | 功能            | 示例                                     |
| ------------------------------- | --------------- | ---------------------------------------- |
| `.toHaveLength(n)`              | 检查长度        | `expect([1,2]).toHaveLength(2)`          |
| `.toHaveProperty(path, value?)` | 检查属性存在/值 | `expect({a:1}).toHaveProperty('a', 1)`   |
| `.toMatchObject(object)`        | 部分对象匹配    | `expect({a:1,b:2}).toMatchObject({a:1})` |

## 函数调用匹配器

| 方法                                   | 功能             | 示例                                          |
| -------------------------------------- | ---------------- | --------------------------------------------- |
| `.toHaveBeenCalled()`                  | 函数是否被调用   | `expect(fn).toHaveBeenCalled()`               |
| `.toHaveBeenCalledTimes(n)`            | 函数调用次数     | `expect(fn).toHaveBeenCalledTimes(1)`         |
| `.toHaveBeenCalledWith(...args)`       | 函数调用参数     | `expect(fn).toHaveBeenCalledWith(1, 2)`       |
| `.toHaveBeenLastCalledWith(...args)`   | 最后一次调用参数 | `expect(fn).toHaveBeenLastCalledWith(1, 2)`   |
| `.toHaveBeenNthCalledWith(n, ...args)` | 第 n 次调用参数  | `expect(fn).toHaveBeenNthCalledWith(1, 1, 2)` |
| `.toHaveReturned()`                    | 函数是否成功返回 | `expect(fn).toHaveReturned()`                 |
| `.toHaveReturnedTimes(n)`              | 函数成功返回次数 | `expect(fn).toHaveReturnedTimes(1)`           |
| `.toHaveReturnedWith(value)`           | 函数返回值       | `expect(fn).toHaveReturnedWith(1)`            |
| `.toHaveLastReturnedWith(value)`       | 最后一次返回值   | `expect(fn).toHaveLastReturnedWith(1)`        |
| `.toHaveNthReturnedWith(n, value)`     | 第 n 次返回值    | `expect(fn).toHaveNthReturnedWith(1, 1)`      |

## 错误匹配器

| 方法                                            | 功能         | 示例                                              |
| ----------------------------------------------- | ------------ | ------------------------------------------------- |
| `.toThrow(error?)`                              | 是否抛出错误 | `expect(()=>{throw Error()}).toThrow()`           |
| `.toThrowErrorMatchingSnapshot(hint?)`          | 错误匹配快照 | `expect(fn).toThrowErrorMatchingSnapshot()`       |
| `.toThrowErrorMatchingInlineSnapshot(snapshot)` | 内联错误快照 | `expect(fn).toThrowErrorMatchingInlineSnapshot()` |

## 非对称匹配器

| 方法                                       | 功能                     | 示例                                                            |
| ------------------------------------------ | ------------------------ | --------------------------------------------------------------- |
| `expect.anything()`                        | 匹配非 null/undefined 值 | `expect(5).toEqual(expect.anything())`                          |
| `expect.any(constructor)`                  | 匹配特定类型实例         | `expect(5).toEqual(expect.any(Number))`                         |
| `expect.arrayContaining(array)`            | 数组包含特定项           | `expect([1,2]).toEqual(expect.arrayContaining([1]))`            |
| `expect.not.arrayContaining(array)`        | 数组不包含特定项         | `expect([1,2]).toEqual(expect.not.arrayContaining([3]))`        |
| `expect.objectContaining(object)`          | 对象包含特定属性         | `expect({a:1}).toEqual(expect.objectContaining({a:1}))`         |
| `expect.not.objectContaining(object)`      | 对象不包含特定属性       | `expect({a:1}).toEqual(expect.not.objectContaining({b:2}))`     |
| `expect.stringContaining(string)`          | 字符串包含子串           | `expect('hello').toEqual(expect.stringContaining('ell'))`       |
| `expect.not.stringContaining(string)`      | 字符串不包含子串         | `expect('hello').toEqual(expect.not.stringContaining('world'))` |
| `expect.stringMatching(regexp/string)`     | 字符串匹配正则           | `expect('hello').toEqual(expect.stringMatching(/ell/))`         |
| `expect.not.stringMatching(regexp/string)` | 字符串不匹配正则         | `expect('hello').toEqual(expect.not.stringMatching(/world/))`   |
| `expect.closeTo(number, digits?)`          | 近似数值匹配             | `expect(0.1+0.2).toEqual(expect.closeTo(0.3, 5))`               |

## 断言计数

| 方法                     | 功能               | 示例                                                             |
| ------------------------ | ------------------ | ---------------------------------------------------------------- |
| `expect.assertions(n)`   | 验证断言调用次数   | `test('', () => { expect.assertions(1); expect(1).toBe(1); })`   |
| `expect.hasAssertions()` | 验证至少有一个断言 | `test('', () => { expect.hasAssertions(); expect(1).toBe(1); })` |

## 扩展工具

| 方法                                       | 功能                 | 示例                                                                       |
| ------------------------------------------ | -------------------- | -------------------------------------------------------------------------- |
| `expect.addEqualityTesters(testers)`       | 添加自定义相等测试器 | `expect.addEqualityTesters([myTester])`                                    |
| `expect.addSnapshotSerializer(serializer)` | 添加快照序列化器     | `expect.addSnapshotSerializer(mySerializer)`                               |
| `expect.extend(matchers)`                  | 扩展自定义匹配器     | `expect.extend({ toBeWithinRange(received, floor, ceiling) { /*...*/ } })` |
