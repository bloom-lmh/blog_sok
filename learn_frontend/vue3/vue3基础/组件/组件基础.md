# 组件基础

[[toc]]

## 定义组件

组件是对样式，行为的封装，一个页面是由多个组件构成。Vue 定义组件有两种方式：

### 使用 vue 单文件定义组件

当使用构建步骤时，我们一般会将 Vue 组件定义在一个单独的 `.vue` 文件中，这被叫做单文件组件 (简称 SFC)

```vue
<script setup>
import { ref } from 'vue';

const count = ref(0);
</script>

<template>
  <button @click="count++">You clicked me {{ count }} times.</button>
</template>
```

### 使用对象定义组件

当不使用构建步骤时，一个 Vue 组件以一个包含 Vue 特定选项的 JavaScript 对象来定义：

#### 使用模板字符串

Vue 将会在运行时编译内联的 JavaScript 字符串

```js
import { ref } from 'vue';
// 包含vue特点选项的对象
export default {
  setup() {
    const count = ref(0);
    return { count };
  },
  template: `
    <button @click="count++">
      You clicked me {{ count }} times.
    </button>`,
};
```

#### 引用 DOM 元素作为模板字符串

除了使用模板字符串，你也可以使用 ID 选择器来指向一个元素 (通常是原生的 `<template>` 元素)，Vue 将会使用其内容作为模板来源。比如

```html
<template id="my-template-element">
  <button @click="count++">You clicked me {{ count }} times.</button>
</template>

<script>
  import { ref } from 'vue';

  export default {
    setup() {
      const count = ref(0);
      return { count };
    },
    template: '#my-template-element',
  };
</script>
```

::: warning 直接在 DOM 中编写模板有一些注意事项：

1. 使用`kebab-case`命名：HTML 标签和属性名称是不分大小写的，所以浏览器会把任何大写的字符解释为小写这意味着当你使用 DOM 内的模板时，无论是 `PascalCase` 形式的组件名称、`camelCase` 形式的 `prop` 名称还是 `v-on` 的事件名称，都需要转换为相应等价的 `kebab-case` (短横线连字符) 形式：

```html
<!-- HTML 中的 kebab-case -->
<blog-post post-title="hello!" @update-post="onUpdatePost"></blog-post>
```

2. 显示的闭合标签：Vue 的模板解析器支持任意标签使用 /> 作为标签关闭的标志,然而在 DOM 内模板中，我们必须显式地写出关闭标签，这是由于 HTML 只允许一小部分特殊的元素省略其关闭标签，最常见的就是 `<input>` 和 `<img>`。对于其他的元素来说，如果你省略了关闭标签，原生的 HTML 解析器会认为开启的标签永远没有结束，用下面这个代码片段举例来说：

```html
<my-component />
<!-- 我们想要在这里关闭标签... -->
<span>hello</span>
<!-- 但是这里省略了 -->
<!-- 将被解析为： -->
<my-component>
  <span>hello</span>
</my-component>
<!-- 但浏览器会在这里关闭标签 -->
```

3. 元素位置限制：某些 HTML 元素对于放在其中的元素类型有限制，例如 `<ul>，<ol>，<table>` 和 `<select>`，相应的，某些元素仅在放置于特定元素中时才会显示，例如 `<li>，<tr>` 和 `<option>`，解决方案在下面会介绍

:::

## 导出组件

上面的例子中定义了一个组件，并在一个 .js 文件里默认导出了它自己，但你也可以通过具名导出在一个文件中导出多个组件。

## 注册组件

一个 Vue 组件在使用前需要先被注册，这样 Vue 才能在渲染模板时找到其对应的实现。组件注册有两种方式：全局注册和局部注册

### 局部注册

### 全局注册

我们可以使用 Vue 应用实例的 `.component()` 方法，让组件在当前 Vue 应用中全局可用。

```ts
import { createApp } from 'vue';
import ComponentB from './App.vue';

const app = createApp({});
app
  .component(
    // 注册的名字
    'ComponentA',
    // 组件的实现 (包含vue选项的对象)
    {
      /* ... */
    },
    // 如果使用单文件组件，你可以注册被导入的 .vue 文件：
  )
  .component('ComponentB', ComponentB);
```

::: warning 全局注册的弊端
全局注册虽然很方便，但有以下几个问题：

1. 即使全局注册的组件没有被使用过，在生产打包时也不会被自动移除（tree-shaking）
2. 会导致依赖关系不明确，在父组件中使用子组件时，不太容易定位子组件的实现，这可能会影响应用长期的可维护性

:::

### 局部注册

在使用 `<script setup>` 的单文件组件中，导入的组件可以直接在模板中使用，无需注册：

```vue
<script setup>
import ComponentA from './ComponentA.vue';
</script>

<template>
  <ComponentA />
</template>
```

如果没有使用 `<script setup>`，则需要使用 components 选项来显式注册:

```js
import ComponentA from './ComponentA.js';

export default {
  components: {
    ComponentA: ComponentA
    // 当然也可以使用ES6的语法糖来写：
    // ComponentA
  },
  }
  setup() {
    // ...
  },
};
```

::: tip 组件命名
组件的命名应该始终使用 `PascalCase` (首字母大写) 格式，因为

1. `PascalCase` 是合法的 JavaScript 标识符
2. `<PascalCase />` 在模板中更明显地表明了这是一个 Vue 组件，而不是原生 HTML 元素。同时也能够将 Vue 组件和自定义元素 (web components) 区分开来

:::

## 使用组件

### 组件的命名格式

上面讲到，模板定义有三种方式

- 在单文件组件中使用模板
- 在对象中使用模板字符串
- 引用 DOM 做为模板

但是 DOM 作为模板会受到 HTML 的限制（它会忽略标签、属性等字母的大小写）所以在 DOM 中使用组件、属性等时需要使用`kebab-case`命名。
为了方便，Vue 支持将模板中使用 `kebab-case` 的标签解析为使用 `PascalCase` 注册的组件。这意味着一个以 `MyComponent` 为名注册的组件，在模板 (或由 Vue 渲染的 HTML 元素) 中可以通过 `<MyComponent>` 或 `<my-component>` 引用。这让我们能够使用同样的 JavaScript 组件注册代码来配合不同来源的模板。

::: tip 使用技巧
在单文件组件中，推荐为子组件使用 `PascalCase` 的标签名，以此来和原生的 HTML 元素作区分。虽然原生 HTML 标签名是不区分大小写的，但 Vue 单文件组件是可以在编译中区分大小写的。我们也可以使用 `/>` 来关闭一个标签。
:::

### 元素位置限制解决

同一也是当使用真实 DOM 作为模板时，会有一些元素类型限制，例如 `<ul>，<ol>，<table> 和 <select>`，相应的，某些元素仅在放置于特定元素中时才会显示，例如 `<li>，<tr>` 和 `<option>`。

这将导致在使用带有此类限制元素的组件时出现问题。例如：

```html
<table>
  <blog-post-row></blog-post-row>
</table>
```

自定义的组件 `<blog-post-row>` 将作为无效的内容被忽略，因而在最终呈现的输出中造成错误。我们可以使用特殊的 `is attribute` 作为一种解决方案(is 的用法将在动态组件章节中进行讲解)：

```html
<table>
  <tr is="vue:blog-post-row"></tr>
</table>
```

::: tip 注意
当使用在原生 HTML 元素上时，is 的值必须加上前缀 vue: 才可以被解析为一个 Vue 组件。这一点是必要的，为了避免和原生的自定义内置元素相混淆。
:::
