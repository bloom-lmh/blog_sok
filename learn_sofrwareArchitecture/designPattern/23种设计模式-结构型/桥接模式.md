# 桥接模式

[[toc]]

## 定义

桥接模式（Bridge Pattern）是一种结构型设计模式，它主要用于将抽象与实现解耦，使得它们可以独立变化。桥接模式的核心思想是将抽象部分（`Abstraction`）与它的实现部分（`Implementor`）分离，使它们都可以独立地变化。

## 结构

角色

- 抽象化（Abstraction）角色：定义抽象类的接口，并保存一个对实现化对象的引用。
- 扩展抽象化（Refined Abstraction）角色：抽象化角色的子类，实现它要求的业务逻辑，并通过组合关系调用实现化角色中的业务方法。
- 实现化（Implementor）角色：这个接口定义了实现化角色的接口，但不给出具体的实现。
- 具体实现化（Concrete Implementor）角色：实现化角色的具体实现类。

![类图](https://image-bucket-1307756649.cos.ap-chengdu.myqcloud.com/image/image.jpeg)

## 实现

需求：钢笔和墨水。不同的钢笔使用不同的颜色的墨水来绘制图片
钢笔和墨水是两个独立变化的维度，钢笔抽象出具体绘制方法，实际持有墨水引用，具体绘制是调用墨水的绘制来进行绘制，实现了钢笔和墨水进行解耦
::: code-group

```ts [钢笔]
// 钢笔抽象类
class Pen {
  constructor(ink) {
    if (new.target === Pen) {
      throw new Error('Cannot instantiate abstract class');
    }
    this.ink = ink;
  }

  draw() {
    throw new Error('Abstract method: draw() must be implemented');
  }
}

// 细钢笔（具体实现）
class ThinPen extends Pen {
  draw() {
    console.log(`用细钢笔蘸${this.ink.getColor()}墨水绘制线条`);
  }
}

// 粗钢笔（具体实现）
class ThickPen extends Pen {
  draw() {
    console.log(`用粗钢笔蘸${this.ink.getColor()}墨水绘制线条`);
  }
}

// 书法钢笔（具体实现）
class CalligraphyPen extends Pen {
  draw() {
    console.log(`用书法钢笔蘸${this.ink.getColor()}墨水写出艺术字`);
  }
}
```

```ts [墨水]
// 墨水接口（抽象）
class Ink {
  getColor() {
    throw new Error('Abstract method: getColor() must be implemented');
  }
}

// 红色墨水（具体实现）
class RedInk extends Ink {
  getColor() {
    return '红色';
  }
}

// 蓝色墨水（具体实现）
class BlueInk extends Ink {
  getColor() {
    return '蓝色';
  }
}

// 绿色墨水（具体实现）
class GreenInk extends Ink {
  getColor() {
    return '绿色';
  }
}
```

```ts [使用]
// 创建不同颜色的墨水
const redInk = new RedInk();
const blueInk = new BlueInk();
const greenInk = new GreenInk();

// 创建不同种类的钢笔并使用不同墨水
const thinRedPen = new ThinPen(redInk);
const thickBluePen = new ThickPen(blueInk);
const calligraphyGreenPen = new CalligraphyPen(greenInk);

// 使用钢笔绘制
thinRedPen.draw(); // 输出: 用细钢笔蘸红色墨水绘制线条
thickBluePen.draw(); // 输出: 用粗钢笔蘸蓝色墨水绘制线条
calligraphyGreenPen.draw(); // 输出: 用书法钢笔蘸绿色墨水写出艺术字

// 可以随意组合钢笔和墨水
const thinBluePen = new ThinPen(blueInk);
thinBluePen.draw(); // 输出: 用细钢笔蘸蓝色墨水绘制线条
```

:::

## 优缺点

桥接模式的优点

- 降低耦合性：抽象和实现之间的解耦使得它们可以独立地改变。
- 可扩展性：抽象和实现都可以独立地扩展，而不需要修改已有的代码。
- 可维护性：由于抽象和实现之间的清晰分离，使得系统更容易理解和维护。
- 符合开闭原则：可以在不修改现有代码的情况下添加新的抽象或实现。

桥接模式的缺点

- 会增加系统的理解与设计难度，由于关联关系建立在抽象层，要求开发者一开始就要针对抽象层进行设计与编程
- 正确识别出系统中两个独立变化的维度并不是一件容易的事情

桥接模式适用环境

- 需要在抽象化和具体化之间增加更多的灵活性，避免在两个层次之间建立静态的继承关系
- 抽象部分和实现部分可以以继承的方式独立扩展而互不影响
- 一个类存在两个（或多个）独立变化的维度，且这两个（或多个）维度都需要独立地进行扩展
- 不希望使用继承或因为多层继承导致系统类的个数急剧增加的系统
